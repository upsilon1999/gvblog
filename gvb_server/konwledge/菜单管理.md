## 菜单添加

```go
package menu_api

import (
	"gvb_server/global"
	"gvb_server/models"
	"gvb_server/models/res"

	"github.com/gin-gonic/gin"
)

func (MenuApi) MenuCreateView(c *gin.Context) {
	var cr MenuRequest
	err := c.ShouldBindJSON(&cr)
	if err != nil {
		res.FailWithError(err, &cr, c)
		return
	}

	// 重复值判断


	//这应该写在一个事务里面，否则会出现插入菜单表成功，但是插入另一张表失败的案例

	// 1.创建banner数据入库
	menuModel := models.MenuModel{
		Title:    cr.Title,
		TitleEn:  cr.TitleEn,
		Slogan:       cr.Slogan,
		Abstract:     cr.Abstract,
		AbstractTime: cr.AbstractTime,
		BannerTime:   cr.BannerTime,
		Sort:         cr.Sort,
		Path: cr.Path,
	}

	err = global.DB.Create(&menuModel).Error

	if err != nil {
		global.Log.Error(err)
		res.FailWithMessage("菜单添加失败", c)
		return
	}
	if len(cr.ImageSortList) == 0 {
		res.OkWithMessage("菜单添加成功", c)
		return
	}

	var menuBannerList []models.MenuBannerModel

	for _, sort := range cr.ImageSortList {
		// 这里也得判断image_id是否真正有这张图片
		menuBannerList = append(menuBannerList, models.MenuBannerModel{
			MenuID:   menuModel.ID,
			BannerID: sort.ImageID,
			Sort:     sort.Sort,
		})
	}
	// 2.给第三张表入库
	err = global.DB.Create(&menuBannerList).Error
	if err != nil {
		global.Log.Error(err)
		res.FailWithMessage("菜单图片关联失败", c)
		return
	}
	res.OkWithMessage("菜单添加成功", c)
}
```

添加的参数

```json
{
    "title": "首页",
    "titleEn": "index",
    "path": "/index",
    "slogan": "个人博客",
    "abstract": [
        "我的博客"
    ],
    "abstractTime": 7,
    "bannerTime": 7,
    "sort": 1,
    "imageSortList": [
        {
            "imageId": 1,
            "sort": 0
        }
    ]
}
```



**优化处理**

```sh
1.应该使用一个事务来管理
```

**注意事项**

添加时外键报错

```sh
`gvb_db`,`menu_banner_models`, CONSTRAINT `fk_menu_banner_models_banner_model` FOREIGN KEY (`banner_id`) REFERENCES `banner_models` (`id`)
```

是因为外键依赖，我们插入的banner_id在banner_models表中不存在