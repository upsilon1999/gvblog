## å•å…ƒé‡ç‚¹

```sh
1.React Routerç°ä»£æ•°æ®åŠ è½½èƒ½åŠ›
2.å¦‚ä½•è§„åˆ’ä¸€ä¸ªä¸“ä¸šé¡¹ç›®
```

## Application Planning

p283

å›é¡¾ç®€å•Reacté¡¹ç›®çš„æ­¥éª¤

```sh
1.å°†æ‰€éœ€çš„ç”¨æˆ·ç•Œé¢æ‹†åˆ†æˆç»„ä»¶
2.æ„å»ºæ²¡æœ‰stateçš„é™æ€é¡µé¢
3.è€ƒè™‘çŠ¶æ€ç®¡ç†å’Œæ•°æ®æµ
```

å½“æˆ‘ä»¬æ„ç­‘ä¸€ä¸ªæœ‰å¤šé¡µé¢çš„å¤§å‹åº”ç”¨æ—¶

```sh
1.æ”¶é›†åº”ç”¨ç¨‹åºéœ€æ±‚å’Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½(Gather application requirements and features)
2.æ ¹æ®1ä¸­çš„å†…å®¹æŠŠåº”ç”¨åˆ†æˆå¤šä¸ªé¡µé¢(Divide the application into pages)
ã€åˆ†é¡¹ã€‘
** a. è€ƒè™‘æ•´ä½“å’Œé¡µé¢çº§åˆ«çš„ç”¨æˆ·ç•Œé¢(Think about the overall and page-level UI)
** b.å°†æ‰€éœ€çš„ç”¨æˆ·ç•Œé¢åˆ†è§£æˆç»„ä»¶(Break the desired UI into components)
** c.è®¾è®¡å’Œå»ºç«‹ä¸€ä¸ªæ²¡æœ‰stateçš„é™æ€é¡µé¢(Design and build a static version--no state yet)

3.å°†åº”ç”¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºç‰¹æ€§åˆ’åˆ†ä¸ºå¤šä¸ªç‰¹æ€§ç±»åˆ«(Divide the application into feature categories)
ã€åˆ†é¡¹ã€‘
** a.è€ƒè™‘çŠ¶æ€ç®¡ç†å’Œæ•°æ®æµ(Think about state management+data flow)
4.å†³å®šä½¿ç”¨å¯¹åº”çš„åº“(Decide on what libraries to use)
```

ä¸€èˆ¬åœ¨çœ‹å®Œéœ€æ±‚åä¼šè¿›å…¥ç±»åˆ«æ€è€ƒï¼Œå°±æ˜¯è€ƒè™‘`Features+Pages`ï¼Œä¾‹å¦‚

| FeaturesåŠŸèƒ½é¡¹ |   Pages(å¯¹åº”é¡µé¢)   |   è®¾ç½®è·¯ç”±   |
| :------------: | :-----------------: | :----------: |
| User(ç”¨æˆ·ç•Œé¢) |      HomePage       |     `/`      |
| Menu(èœå•ç•Œé¢) |     Pizza Menu      |   `/menu`    |
|  Cart(è´­ç‰©è½¦)  |        Cart         |   `/cart`    |
|  Order(è®¢å•)   | Placing a new order | `/order/new` |

å³é€šè¿‡åŠŸèƒ½æ¥ç¡®å®šéœ€è¦å“ªäº›é¡µé¢ï¼Œä¸€ä¸ªåŠŸèƒ½å¯ä»¥å¯¹åº”å¤šä¸ªé¡µé¢ã€‚

ç°åœ¨ç»§ç»­è€ƒè™‘çŠ¶æ€ç®¡ç†å’ŒæŠ€æœ¯æ ˆï¼Œæ ¹æ®åŠŸèƒ½ç‚¹è€ƒè™‘ä»–ä»¬çš„çŠ¶æ€çš„æ€§è´¨ï¼Œä¾‹å¦‚

| FeaturesåŠŸèƒ½é¡¹ |               å¯èƒ½çš„çŠ¶æ€               |
| :------------: | :------------------------------------: |
| User(ç”¨æˆ·ç•Œé¢) |        å…¨å±€UIçŠ¶æ€ï¼Œä¿å­˜åœ¨appä¸­         |
| Menu(èœå•ç•Œé¢) |     å…¨å±€remoteçŠ¶æ€ï¼Œæ•°æ®ä»APIè·å–      |
|  Cart(è´­ç‰©è½¦)  | å…¨å±€UIçŠ¶æ€ï¼Œä¸éœ€è¦APIï¼Œåªéœ€å­˜å‚¨åœ¨Appä¸­ |
|  Order(è®¢å•)   |  å…¨å±€RemoteçŠ¶æ€ï¼Œè·å–å’Œæäº¤æ•°æ®åˆ°API   |

é€‰æ‹©æŠ€æœ¯æ ˆ

```sh
ã€è·¯ç”±Routingã€‘
åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ React Router

ã€æ ·å¼æˆ–è€…è¯´UIç»„ä»¶ Stylingã€‘
è¿™é‡Œæ—¶äº‰è®®æ€§æœ€å¤§çš„ï¼Œç°åœ¨æµè¡Œçš„æŠ€æœ¯æ ˆæœ‰
tailwindcss

ã€Remote state managementè¿œç¨‹çŠ¶æ€ç®¡ç†ã€‘
React Routerï¼Œä»6ç‰ˆæœ¬å¼€å§‹ï¼Œè¯¥ç»„ä»¶å…è®¸è¾¹è·å–è¾¹å‘ˆç°

ã€UI state managementã€‘
Redux ä¸€èˆ¬é€‰æ‹©è¿™ç§å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·
```

## å»ºç«‹ä¸€ä¸ªä¸“ä¸šçš„æ–‡ä»¶ç»“æ„

```sh
ã€featuresã€‘
åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåŠŸèƒ½ç›®å½•ï¼Œæ ¹æ®ä¸åŒçš„åŠŸèƒ½å†åœ¨å…¶ä¸‹æ„ç­‘å­ç›®å½•
è®©æˆ‘ä»¬å°†æœ‰å…³åŠŸèƒ½çš„éè·¯ç”±ç»„ä»¶ã€storeæ–‡ä»¶ã€è‡ªå®šä¹‰hookç­‰éƒ½æ‹†åˆ†åœ¨è¿™äº›åŠŸèƒ½å­ç›®å½•ä¸‹

å®é™…ä¸Šå°±æ—¶ä¸å†ä½¿ç”¨componnentsè¿™ä¸ªå¤§ç›®å½•ï¼Œå› ä¸ºå®ƒå­˜æ”¾äº†æ‰€æœ‰ç»„ä»¶è®©æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“å¹²ä»€ä¹ˆ

ã€uiã€‘
è¿™ä¸ªç›®å½•ç”¨æ¥å­˜æ”¾å¯é‡ç”¨çš„UIç»„ä»¶ï¼Œä¸åŒ…å«å‰¯ä½œç”¨ï¼Œä¾‹å¦‚æŒ‰é’®ç­‰

ã€servicesã€‘
è¿™ä¸ªç›®å½•ç”¨äºå­˜æ”¾ä¸æœåŠ¡å™¨ç›¸å…³çš„æ–‡ä»¶ï¼Œå³ç”¨äºä¸APIäº¤äº’çš„å…¬å…±æ–¹æ³•

ã€utilsã€‘
è¿™ä¸ªç›®å½•ä¸‹æ”¾æˆ‘ä»¬å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹é‡ç”¨çš„å¸®åŠ©å‡½æ•°ï¼Œä»–ä»¬å…·å¤‡å¯é‡ç”¨ã€ä¸äº§ç”Ÿå‰¯ä½œç”¨ã€æ— çŠ¶æ€çš„ç‰¹æ€§ï¼Œä¾‹å¦‚ç”¨äºæ—¥æœŸå’Œæ—¶é—´çš„æ“ä½œ
```

## React è·¯ç”±è¿›é˜¶

### React Routerèµ„æ–™

ä¸­æ–‡æ–‡æ¡£åœ°å€

```sh
https://baimingxuan.github.io/react-router6-doc/
```

### Routeså®šä¹‰æ–°æ–¹å¼

React Router6.4å¼•å…¥äº†ä¸€ç§æ–°çš„å®šä¹‰Routesçš„æ–¹å¼

å®‰è£…è·¯ç”±å™¨

```sh
npm i react-router-dom@6
```

ä½¿ç”¨è·¯ç”±æ•°ç»„å®šä¹‰Routesï¼Œä¾‹å¦‚

```jsx
//å¼•å…¥åˆ›å»ºè·¯ç”±å™¨çš„æ–¹æ³•
import {createBrowserRouter,RouterProvider} from "react-router-dom"

import Home from "./ui/Home"

/*
	createBrowserRouter()
	è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹å°±æ˜¯ä¸€æ¡è·¯ç”±è§„åˆ™

	è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªè·¯ç”±å™¨
*/
const myRouter = createBrowserRouter([
    {
        //è·¯ç”±è·¯å¾„
        path:"/",
        //è·¯å¾„å¯¹åº”ç»„ä»¶
        element:<Home/>
    },
])
    
function App(){
    return (
        {/*
        	åœ¨è¦ä½¿ç”¨è·¯ç”±å™¨çš„åœ°æ–¹ä½¿ç”¨RouterProvider
        	
        	è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹ContextAPIçš„å°è£…ï¼Œå…¶ä¸Šçš„routerå±æ€§å°±ç”¨äºæ¥æ”¶æˆ‘ä»¬çš„è·¯ç”±å™¨
        */}
    	<RouterProvider router={myRouter}/>
    )
}
```

è®©æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ä¼ ç»Ÿçš„ä½¿ç”¨æ–¹å¼

```jsx
import {BrowserRouter,Routes,Route} from "react-router-dom"
import Home from "./ui/Home"
function App(){
    return (
        <BrowserRouter>
            <Routes>
                <Route path="/" element={<Home/>}/>
            </Routes>
        </BrowserRouter>
    )
}
```

ç°ä»£çš„è·¯ç”±å…è®¸æˆ‘ä»¬åœ¨è·¯ç”±ä¸­è¯·æ±‚æ•°æ®å’Œæäº¤è¡¨å•ï¼Œåç»­ä¼šè¯´åˆ°ï¼Œè¿™äº›æ˜¯ä¼ ç»Ÿè·¯ç”±ä¸å…·å¤‡çš„åŠŸèƒ½ã€‚

### å­è·¯ç”±å‘ˆç°

æˆ‘ä»¬å…ˆæ¥çœ‹å­è·¯ç”±çš„å®ç°ï¼Œä¼ ç»Ÿ

```jsx
import {BrowserRouter,Routes,Route} from "react-router-dom"
import Home from "./ui/Home"
function App(){
    return (
        <BrowserRouter>
            <Routes>
                <Route path="/" element={<Home/>}>
                    <Route path="home" element={<HomePage/>}>
                </Route>
            </Routes>
        </BrowserRouter>
    )
}
```

è€Œå¯¹äºè·¯ç”±è§„åˆ™ï¼Œåˆ™åªéœ€è¦ä½¿ç”¨childrenå±æ€§å³å¯

```jsx
//å¼•å…¥åˆ›å»ºè·¯ç”±å™¨çš„æ–¹æ³•
import {createBrowserRouter,RouterProvider} from "react-router-dom"

import Home from "./ui/Home"
import HomePage from "./ui/HomePage"
const myRouter = createBrowserRouter([
    {
        path:"/",
        element:<Home/>,
        children:[
            {
              path:"home",
        	  element:<HomePage/>,  
            }
        ]
    },
])
    
function App(){
    return (
    	<RouterProvider router={myRouter}/>
    )
}
```

æˆ‘ä»¬å¯èƒ½ä¼šè®¾æƒ³å¦‚ä¸‹ä¸€ç§ç»“æ„ï¼Œå‡è®¾ä»¥AppLayoutç»„ä»¶ä½œä¸ºå¸ƒå±€

```jsx
function AppLayout(){
    return (
    	<>
        	<Header/>
        	<main>
            	{/*è·¯ç”±ç»„ä»¶å±•ç¤ºåœ¨è¿™é‡Œ*/}
        	</main>
        	<Footer/>
        </>
    )
}
```

å°±æ˜¯è®©ä¸€äº›è·¯ç”±ç»„ä»¶åªåœ¨ç‰¹å®šçš„åœ°æ–¹å‘ˆç°ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­è·¯ç”±

```jsx
//å¼•å…¥åˆ›å»ºè·¯ç”±å™¨çš„æ–¹æ³•
import {createBrowserRouter,RouterProvider} from "react-router-dom"

import AppLayout from "./ui/AppLayout"
import Home from "./ui/Home"
import Cart from "./features/Cart"
const myRouter = createBrowserRouter([
    {
        //å¦‚æœæœ‰è·¯å¾„ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªçˆ¶è·¯ç”±ï¼Œæ‰€æœ‰çš„å­è·¯ç”±çš„è·¯å¾„å‰ä¸èƒ½å¸¦/
        //å¦‚æœæ²¡æœ‰è·¯å¾„å°±æ˜¯è·¯ç”±å™¨ï¼Œå®é™…ä¸Šæ˜¯åŒ…è£¹æ‰€æœ‰è·¯ç”±ç»„ä»¶
        element:<AppLayout/>,
        children:[
            {
              path:"/",
        	  element:<Home/>,  
            },
            {
               path:"/cart",
               element:<Cart/>
            }
        ]
    },
])
    
function App(){
    return (
    	<RouterProvider router={myRouter}/>
    )
}
```

ä¸‹é¢æˆ‘ä»¬éœ€è¦å‘ˆç°å­è·¯ç”±ï¼Œç”¨çš„æ˜¯å’Œä¹‹å‰ä¸€æ ·çš„ç»„ä»¶ï¼Œ

```jsx
//ç”¨äºå‘ˆç°åµŒå¥—è·¯ç”±ï¼Œå­ç»„ä»¶
import {Outlet} from "react-router-dom"

function AppLayout(){
    return (
    	<>
        	<Header/>
        	<main>
            	{/*è·¯ç”±ç»„ä»¶å±•ç¤ºåœ¨è¿™é‡Œ*/}
            	<Outlet/>
        	</main>
        	<Footer/>
        </>
    )
}
```

### æ•°æ®åŠ è½½loader

ç”±äº URL æ®µé€šå¸¸æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–æ•°æ®ï¼Œå› æ­¤ React Router æä¾›äº†ä¼ ç»Ÿçš„æ•°æ®åŠ è½½é’©å­ï¼Œä»¥ä¾¿åœ¨å¯¼èˆªè¿‡ç¨‹ä¸­å¯åŠ¨æ•°æ®åŠ è½½ã€‚ç»“åˆåµŒå¥—è·¯ç”±ï¼Œå¯ä»¥å¹¶è¡ŒåŠ è½½ç‰¹å®š URL ä¸Šå¤šä¸ªå¸ƒå±€çš„æ‰€æœ‰æ•°æ®ã€‚

å¸¸è§æ“ä½œæ˜¯ï¼Œåœ¨è®¿é—®è·¯ç”±ç»„ä»¶æ—¶å‘èµ·APIè¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚ç»“æœå¸¦ç»™è·¯ç”±ç»„ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬æ¥è·å–èœå•æ•°æ®ï¼Œåˆ†ä¸‰æ­¥è¿›è¡Œ

* 1.åˆ›å»ºåŠ è½½ç¨‹åº

  ç†è®ºä¸Šè¿™ä¸ªåŠ è½½å‡½æ•°å¯ä»¥æ”¾åœ¨ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½ä¼šæ”¾åœ¨è·¯ç”±ç»„ä»¶ä¸­ï¼Œä¾‹å¦‚

  ```jsx
  import { getMenu } from '../../services/apiRestaurant';
  
  function Menu() {
    const menu = useLoaderData();
    return (
      <p>æˆ‘æ˜¯èœå•</p>
    );
  }
  
  //åŠ è½½å‡½æ•°(åŠ è½½ç¨‹åº)ï¼Œ
  //åŠŸèƒ½ï¼šè·å–èœå•æ•°æ®å¹¶è¿”å›
  //å¯¼å‡ºè¯¥å‡½æ•°ï¼Œåç»­è¦è¿æ¥åˆ°è·¯ç”±ä¸Š
  export async function loader() {
    const menu = await getMenu();
    return menu;
  }
  
  export default Menu;
  ```

* 2.æä¾›loader

  è¿™ä¸€æ­¥å°±æ˜¯å°†loaderå‡½æ•°è¿æ¥åˆ°è·¯ç”±ä¸Š

  ```jsx
  import {createBrowserRouter,RouterProvider} from "react-router-dom"
  
  import AppLayout from "./ui/AppLayout"
  import Home from "./ui/Home"
  
  //å¼•å…¥loaderå‡½æ•°
  //å¹¶ä¸”åœ¨å¼•å…¥çš„æ—¶å€™å–åˆ«å
  import Menu,{loader as menuLoader} from "./features/menu/Menu"
  
  
  const myRouter = createBrowserRouter([
      {
          element:<AppLayout/>,
          children:[
              {
                path:"/",
          	  element:<Home/>,  
              },
              {
                 path:"/menu",
                 element:<Menu/>,
                 //å°†loaderå‡½æ•°å…³è”åˆ°è·¯ç”±ä¸Š
                 loader:menuLoader
              }
          ]
      },
  ])
      
  function App(){
      return (
      	<RouterProvider router={myRouter}/>
      )
  }
  ```

* 3.å‘é¡µé¢æä¾›æ•°æ®

  é€šè¿‡useLoaderDataè·å–loaderå‡½æ•°è¿”å›çš„æ•°æ®

  ```jsx
  import { getMenu } from '../../services/apiRestaurant';
  import { useLoaderData } from 'react-router-dom';
  function Menu() {
    //è·å–loaderå‡½æ•°çš„è¿”å›å€¼
    const menu = useLoaderData();
    consloe.log(menu)
      
    return (
      <p>æˆ‘æ˜¯èœå•</p>
    );
  }
  
  //åŠ è½½å‡½æ•°(åŠ è½½ç¨‹åº)ï¼Œ
  //åŠŸèƒ½ï¼šè·å–èœå•æ•°æ®å¹¶è¿”å›
  //å¯¼å‡ºè¯¥å‡½æ•°ï¼Œåç»­è¦è¿æ¥åˆ°è·¯ç”±ä¸Š
  export async function menuLoader() {
    const menu = await getMenu();
    return menu;
  }
  
  export default Menu;
  ```

#### ä¼ ç»Ÿè·¯ç”±ä½¿ç”¨æ•°æ®åŠ è½½

```jsx
<Route
  path="/"
  loader={async ({ request }) => {
    const res = await fetch("/api/user.json", {
      signal: request.signal,
    });
    const user = await res.json();
    return user;
  }}
  element={<Root />}
>
</Route>
```

åœ¨Rootç»„ä»¶ä¸­ä½¿ç”¨

```jsx
function Root() {
  const user = useLoaderData();
}
```

#### æ•°æ®åŠ è½½çš„æœ¬è´¨

loaderæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œæ‰§è¡Œæ—¶æœºæ˜¯è·¯ç”±è¢«è®¿é—®æ—¶ï¼Œ

```js
const myRouter = createBrowserRouter([
    {
		 path:"/",
         element:<Home/>, 
         loader:{()=>{
    		return 18
    	 }}
    },
])
```

ä½¿ç”¨

```jsx
function Home() {
  const data = useLoaderData();
  console.log(data)//18
}
```

#### æ•°æ®åŠ è½½å‚æ•°

æ•°æ®åŠ è½½å‡½æ•°æ˜¯æœ‰å‚æ•°çš„ï¼Œä¾‹å¦‚

```js
const myRouter = createBrowserRouter([
    {
		 path:"/",
         element:<Home/>, 
         loader:{(prop)=>{
    		console.log(prop)
    		return 18
    	 }}
    },
])
```

æŸ¥çœ‹æ‰“å°ç»“æœ

```js
{
    context:undefined,
    //Requestå¯¹è±¡
    "request": {
      body: null,
      bodyUsed:false,
      cache: "default",
      credentials: "same-origin",
      destination: "",
      headers: Header{},
      integrity: "",
      isHistoryNavigation: false,
      keepalive: false,
      method: "GET",
      mode: "cors",
      redirect: "follow",
      referrer: "about:client",
      referrerPolicy: "",
      signal: AbortSignal {
          aborted: false, 
          reason: undefined, 
          onabort: null
      },
      targetAddressSpace: "unknown",
      url: "http://localhost:5173/",
     },
    "params": {}
  }
```

##### queryä¼ å‚

```jsx
<Link to="/menu?abc=18">&larr; Back to menu</Link>
```

åœ¨requestå¯¹è±¡ä¸Šçš„urlå¯ä»¥è·å–

```js
{
    "request":{
        url: "http://localhost:5173/menu?abc=18",
    }
}
```

##### paramsä¼ å‚

```jsx
//ä¿®æ”¹è·¯ç”±è§„åˆ™ï¼Œç•™å‡ºå ä½ç¬¦
{
    path:'/menu/:id',
    element:<Menu/>,
    loader:loader
},

//è¿›è¡Œå‚æ•°ä¼ é€’
<Link to="/menu/15">&larr; Back to menu</Link>
```

æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è·å–å‚æ•°ï¼Œä¸€ä¸ªæ˜¯paramså¯¹è±¡ä¸Š

```js
"parmas":{
    "id": "15"
}
```

å¦ä¸€ä¸ªæ˜¯requestçš„urlè·¯å¾„ä¸Š

```js
{
    "request":{
        url: "http://localhost:5173/menu/15",
    }
}
```

##### å°ç»“

ç”±æ­¤å¯è§æˆ‘ä»¬ä¼šå¾ˆæ–¹ä¾¿çš„ç”¨loaderæ¥æ“ä½œparamsè·¯å¾„å‚æ•°ï¼Œqueryå‚æ•°ä¸æ¨èï¼Œstateå‚æ•°ä¸æ”¯æŒ

#### æ¯”è¾ƒuseEffectå’Œæ•°æ®åŠ è½½

å®é™…ä¸Šæ•°æ®åŠ è½½çš„æ“ä½œä¹Ÿå¯ä»¥ç”¨useEffectå®ç°ï¼Œå°±æ˜¯åœ¨è·¯ç”±ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡ŒåŒæ ·çš„é€»è¾‘ã€‚

**åŒºåˆ«**

```sh
ã€æ•°æ®åŠ è½½ã€‘
åœ¨åŠ å…¥è·¯ç”±ç»„ä»¶æ—¶å°±å¼€å§‹æ•°æ®è·å–ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ•°æ®è·å–æˆåŠŸå†è¿›è¡Œæ¸²æŸ“ã€‚

ã€useEffectã€‘
ç»„ä»¶æŒ‚è½½å®Œæˆå†å¼€å§‹è·å–æ•°æ®ã€‚
```

### å¾…å®šå¯¼èˆªç”¨æˆ·ç•Œé¢

å½“ç”¨æˆ·æµè§ˆåº”ç”¨ç¨‹åºæ—¶ï¼Œä¸‹ä¸€é¡µçš„æ•°æ®ä¼šåœ¨é¡µé¢å‘ˆç°ä¹‹å‰åŠ è½½ã€‚åœ¨è¿™æ®µæ—¶é—´å†…æä¾›ç”¨æˆ·åé¦ˆéå¸¸é‡è¦ï¼Œè¿™æ ·æ‰ä¸ä¼šè®©äººæ„Ÿè§‰åº”ç”¨ç¨‹åºååº”è¿Ÿé’ã€‚

`useNavigation`è¿™ä¸ªé’©å­å¯ä»¥æŸ¥çœ‹è·¯ç”±ç»„ä»¶çš„çŠ¶æ€

```jsx
import {useNavigation} from "react-router-dom"
function Home(){
    const navigation = useNavigation()
    consloe.log(navigation)
    return <P>...</P>
}
```

navigationæ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»£è¡¨äº†è¯¥è·¯ç”±ç»„ä»¶çš„ä¿¡æ¯

```js
{
    /*
    	stateè·¯ç”±ç»„ä»¶çš„çŠ¶æ€
    	loading ç»„ä»¶åŠ è½½ä¸­
    	idleç»„ä»¶åŠ è½½å®Œæˆ
    */
    state: "idle",
    formAction: undefined,
    formData: undefined,
    formEncType: undefined,
    formMethod: undefined,
    json: undefined,
    location: undefined,
    text: undefined,
}
```

æˆ‘ä»¬é€šå¸¸å¸Œæœ›å½“è·¯ç”±ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­æœ‰æ‰€æç¤ºï¼Œä¸¾ä¾‹

```jsx
function Root() {
  const navigation = useNavigation();
  return (
    <div>
      {navigation.state === "loading" && <GlobalSpinner />}
      <FakeSidebar />
      <Outlet />
      <FakeFooter />
    </div>
  );
}
```

### è·¯ç”±çš„é”™è¯¯å¤„ç†

å½“ loaderã€action æˆ–ç»„ä»¶æ¸²æŸ“ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼Œè·¯ç”±çš„æ­£å¸¸æ¸²æŸ“è·¯å¾„ ( `<Route element>` ) å°†è¢«æ¸²æŸ“ä¸ºé”™è¯¯è·¯å¾„ ( `<Route errorElement>` )ï¼Œé”™è¯¯ä¿¡æ¯å°†é€šè¿‡ `useRouteError`æ˜¾ç¤ºã€‚

> NOTE
>
> å¦‚æœæ‚¨ä¸æƒ³æŒ‡å®š React å…ƒç´ ï¼ˆå³ `errorElement={<MyErrorBoundary />}` ï¼‰ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ª `ErrorBoundary` ç»„ä»¶ï¼ˆå³ `ErrorBoundary={MyErrorBoundary}` ï¼‰ï¼ŒReact è·¯ç”±å™¨å°†åœ¨å†…éƒ¨ä¸ºæ‚¨è°ƒç”¨ `createElement` ã€‚

**ä¸¾ä¾‹**

```jsx
const myRouter = createBrowserRouter([
    {
      path:"/",
      //å¯èƒ½è¿™é‡Œå¼‚å¸¸
      loader:myLoader,
      //ä¹Ÿå¯èƒ½è¿™é‡Œå¼‚å¸¸
      action:myAction,
      //ç»„ä»¶ä¸æŠ¥é”™å‘ˆç°
      element:<Invoice/>, 
      //ç»„ä»¶å¼‚å¸¸æ—¶ä½¿ç”¨
      errorElement:<ErrorBoundary />
    },
])

function Invoice() {
  return <Link to="/menu/55">Happy</Link>;
}
```

æŠ“å–é”™è¯¯

```jsx
import { useRouteError } from 'react-router-dom';
function ErrorBoundary() {
  //é€šè¿‡é’©å­è·å–é”™è¯¯ä¿¡æ¯ï¼Œè¯¥é”™è¯¯å¯ä»¥ç”±è¯¥è·¯ç”±ç»„ä»¶äº§ç”Ÿï¼Œä¹Ÿå¯ä»¥æ—¶æ•æ‰è‡ªåµŒå¥—å­ç»„ä»¶
  let error = useRouteError();
  console.error(error);
  return <div>Dang!</div>;
}
```

æŸ¥çœ‹errorå¯¹è±¡ä¿¡æ¯

```js
{
    data: "Error: No route matches URL \"/menu/55\"",
    error: {
        message: "No route matches URL \"/menu/55\"",
        stack: "Error: No route matches URL \"/menu/55\"\n  
    },
    internal: true,
    //é”™è¯¯çŠ¶æ€ç 
    status: 404,
    //çŠ¶æ€ç å¯¹åº”çš„é»˜è®¤é”™è¯¯æè¿°
    statusText: "Not Found"
}
```

æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨errorå¯¹è±¡ä¸Šçš„dataå±æ€§æˆ–messageå±æ€§ï¼Œå³

```js
import { useRouteError } from 'react-router-dom';
function ErrorBoundary() {
  //é€šè¿‡é’©å­è·å–é”™è¯¯ä¿¡æ¯ï¼Œè¯¥é”™è¯¯å¯ä»¥ç”±è¯¥è·¯ç”±ç»„ä»¶äº§ç”Ÿï¼Œä¹Ÿå¯ä»¥æ—¶æ•æ‰è‡ªåµŒå¥—å­ç»„ä»¶
  let error = useRouteError();
  console.error(error);
  return <div>{error.data}</div>;
}
```

**è§£é‡Š**

```sh
1.ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯errorå¯¹è±¡ä¸Šçš„dataå±æ€§
2.ä½†æ˜¯è¯·æ±‚å‡ºé”™æ—¶ï¼Œerrorä¸Šæ˜¯æ²¡æœ‰dataå±æ€§çš„ï¼Œè¿™ä¸ªé”™è¯¯åªèƒ½ç”¨errorå¯¹è±¡ä¸Šçš„messageå±æ€§è·å–
ã€æ³¨æ„ã€‘
æ˜¯errorå¯¹è±¡ï¼Œä¸æ˜¯errorå¯¹è±¡ä¸Šçš„errorï¼Œå³
{
    data: "Error: No route matches URL \"/menu/55\"",
    //ä¸æ˜¯è¿™ä¸ª
    error: {
        message: "No route matches URL \"/menu/55\"",
        stack: "Error: No route matches URL \"/menu/55\"\n  
    },
    internal: true,
}
```

**å›é¡¾**

åœ¨è®¾è®¡è·¯ç”±è§„åˆ™æ—¶æˆ‘ä»¬ç»å¸¸ä¼šè®¾è®¡ä¸€æ¡å…œåº•çš„è§„åˆ™ï¼Œå³è®¿é—®çš„è·¯å¾„ä¸å­˜åœ¨æ—¶è¢«å¯¼å‘ä»–ï¼Œä¾‹å¦‚

```js
const myRouter = createBrowserRouter([
            {
              path:"/",
        	  element:<Home/>,  
            },
            {
               path:"/menu",
               element:<Menu/>,
            },
    		{
                path:"*",
                element:<NotFound/>
            }
])
```

å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨è·¯ç”±é”™è¯¯å¤„ç†ç»“åˆåµŒå¥—è·¯ç”±æ¥å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œæ­¤æ—¶ä¸ä»…å¯ä»¥å¤„ç†404é—®é¢˜ï¼Œè¿˜å¯ä»¥å¤„ç†å…¶ä»–é—®é¢˜

```js
const myRouter = createBrowserRouter([
  {
    //ä½¿ç”¨åµŒå¥—è·¯ç”±çš„ç‰¹æ€§ï¼Œå­è·¯ç”±å‡ºé”™ä¼šå†’æ³¡åˆ°çˆ¶è·¯ç”±
    errorElement:<Error/>,
    children:[
      {
        path:'/',
        element:<Home/>
      },
      {
        path:'/menu',
        element:<Menu/>,
        loader:loader
      },
      {
        path:"/cart",
        element:<Cart/>
      },
      {
        path:"/order/new",
        element:<CreateOrder/>
      },
      {
        path:"/order/:orderId",
        element:<Order/>
      },
    ]
  }
])
```

**Errorç»„ä»¶è®¾è®¡ç¤ºèŒƒ**

```jsx
import { useNavigate, useRouteError } from 'react-router-dom';

function NotFound() {
  const navigate = useNavigate();
  let error =  useRouteError()
  console.log(error);
  return (
    <div>
      <h1>Something went wrong ğŸ˜¢</h1>
      {/*é’ˆå¯¹ä¸åŒçš„erroræ•°æ®è·å–*/}
      <p>{error.data||error.message}</p>
      <button onClick={() => navigate(-1)}>&larr; Go back</button>
    </div>
  );
}

export default NotFound;
```

### action

React Routerä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªFormç»„ä»¶ï¼Œå¯ç”¨äºæ›¿æ¢åŸç”Ÿformã€‚å½“æˆ‘ä»¬çš„è¡¨å•çš„äº‹ä»¶ä¸ºä»¥ä¸‹ä¹‹ä¸€æ—¶ï¼Œ

```sh
"post"ã€"put"ã€"patch"ã€"delete"
```

éƒ½ä¼šè°ƒç”¨actionã€‚

**1.å…ˆæ”¹form**

åŸç”Ÿform

```jsx
import { useState } from "react";

// https://uibakery.io/regex-library/phone-number
const isValidPhone = (str) =>
  /^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/.test(
    str
  );

const fakeCart = [
  {
    pizzaId: 12,
    name: "Mediterranean",
    quantity: 2,
    unitPrice: 16,
    totalPrice: 32,
  },
  {
    pizzaId: 6,
    name: "Vegetale",
    quantity: 1,
    unitPrice: 13,
    totalPrice: 13,
  },
  {
    pizzaId: 11,
    name: "Spinach and Mushroom",
    quantity: 1,
    unitPrice: 15,
    totalPrice: 15,
  },
];

function CreateOrder() {
  // const [withPriority, setWithPriority] = useState(false);
  const cart = fakeCart;

  return (
    <div>
      <h2>Ready to order? Let's go!</h2>

      <form>
        <div>
          <label>First Name</label>
          <input type="text" name="customer" required />
        </div>

        <div>
          <label>Phone number</label>
          <div>
            <input type="tel" name="phone" required />
          </div>
        </div>

        <div>
          <label>Address</label>
          <div>
            <input type="text" name="address" required />
          </div>
        </div>

        <div>
          <input
            type="checkbox"
            name="priority"
            id="priority"
            // value={withPriority}
            // onChange={(e) => setWithPriority(e.target.checked)}
          />
          <label htmlFor="priority">Want to yo give your order priority?</label>
        </div>

        <div>
          <button>Order now</button>
        </div>
      </form>
    </div>
  );
}

export default CreateOrder;
```

æ›¿æ¢ä¸ºForm

```jsx
import { useState } from "react";
import { Form } from "react-router-dom";

// https://uibakery.io/regex-library/phone-number
const isValidPhone = (str) =>
  /^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/.test(
    str
  );

const fakeCart = [
  {
    pizzaId: 12,
    name: "Mediterranean",
    quantity: 2,
    unitPrice: 16,
    totalPrice: 32,
  },
  {
    pizzaId: 6,
    name: "Vegetale",
    quantity: 1,
    unitPrice: 13,
    totalPrice: 13,
  },
  {
    pizzaId: 11,
    name: "Spinach and Mushroom",
    quantity: 1,
    unitPrice: 15,
    totalPrice: 15,
  },
];

function CreateOrder() {
  // const [withPriority, setWithPriority] = useState(false);
  const cart = fakeCart;

  return (
    <div>
      <h2>Ready to order? Let's go!</h2>

      <Form method="post">
        <div>
          <label>First Name</label>
          <input type="text" name="customer" required />
        </div>

        <div>
          <label>Phone number</label>
          <div>
            <input type="tel" name="phone" required />
          </div>
        </div>

        <div>
          <label>Address</label>
          <div>
            <input type="text" name="address" required />
          </div>
        </div>

        <div>
          <input
            type="checkbox"
            name="priority"
            id="priority"
            // value={withPriority}
            // onChange={(e) => setWithPriority(e.target.checked)}
          />
          <label htmlFor="priority">Want to yo give your order priority?</label>
        </div>

        <div>
          <button>Order now</button>
        </div>
      </Form>
    </div>
  );
}

export default CreateOrder;
```

**2.ä¹¦å†™actionå‡½æ•°**

ä¸€æ—¦Formç»„ä»¶çš„è¡¨å•æäº¤ï¼Œå°±ä¼šè¿›å…¥è¿™ä¸ªaction

```js
export function action({request}){
    //ä½¿ç”¨requestä¸Šçš„å†…ç½®æ–¹æ³•è·å–formDataï¼Œæ­¤æ—¶è·å–åˆ°çš„æ˜¯FormDataç±»å‹çš„æ•°æ®
    const formData = await request.formData()
   	//å°†FormDataå¯¹è±¡å˜æˆæ™®é€šå¯¹è±¡
    const data = Object.fromEntries(formData)
    //è¿”å›å€¼å¸¸å¸¸è®¾ä¸ºnull
    return null
}
```

3.å°†actionå…³è”åˆ°è·¯ç”±

```js
import CreateOrder,{action as orderAction} from "./features/order/CreateOrder"
const myRouter = createBrowserRouter([
  {
    path:"/order/new",
    element:<CreateOrder/>,
    action:orderAction
  },
])
```

**ç†è§£**

å®é™…ä¸Šå°±æ˜¯è¿”ç’å½’çœŸï¼Œä¸å†éœ€è¦jsæ¥å†™æäº¤äº‹ä»¶ï¼Œè€Œæ˜¯å’ŒHTMLçš„formä¸€æ ·ï¼Œé€šè¿‡æŒ‰é’®ç›´æ¥è§¦å‘æäº¤ã€‚

```sh
1.åªæœ‰å«nameçš„æ‰èƒ½è¢«formDataåŒ…å«ï¼Œä¾‹å¦‚
<input type="tel" name="phone" required />

2.å¦‚æœæƒ³æäº¤æŸä¸ªå€¼ï¼Œåˆä¸æƒ³è®©è¾“å…¥æ¡†å‡ºç°ï¼Œå³éšå¼æäº¤ï¼Œå¯ä»¥å°†è¾“å…¥æ¡†çš„typeè®¾ä¸ºhiddenï¼Œæ¨èå’Œæäº¤æŒ‰é’®åœ¨åŒä¸€çº§
<div>
  <input type="hidden" name="cart" value={JSON.stringify(cart)} />
  <button>Order now</button>
</div>

3.actionçš„ä½œç”¨ï¼Œåœ¨è¡¨å•æäº¤æ—¶è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œé€šå¸¸ç”¨äºé‡æ„è¡¨å•æ•°æ®ï¼Œç„¶åå°†è¯¥è¡¨å•æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™API
```

**å®Œæ•´æ¡ˆä¾‹**

```jsx
import { useState } from "react";
import { Form, redirect } from "react-router-dom";
import { createOrder } from "../../services/apiRestaurant";
// https://uibakery.io/regex-library/phone-number
const isValidPhone = (str) =>
  /^\+?\d{1,4}?[-.\s]?\(?\d{1,3}?\)?[-.\s]?\d{1,4}[-.\s]?\d{1,4}[-.\s]?\d{1,9}$/.test(
    str
  );

const fakeCart = [
  {
    pizzaId: 12,
    name: "Mediterranean",
    quantity: 2,
    unitPrice: 16,
    totalPrice: 32,
  },
  {
    pizzaId: 6,
    name: "Vegetale",
    quantity: 1,
    unitPrice: 13,
    totalPrice: 13,
  },
  {
    pizzaId: 11,
    name: "Spinach and Mushroom",
    quantity: 1,
    unitPrice: 15,
    totalPrice: 15,
  },
];

function CreateOrder() {
  // const [withPriority, setWithPriority] = useState(false);
  const cart = fakeCart;

  return (
    <div>
      <h2>Ready to order? Let's go!</h2>

      {/*æ³¨æ„Formçš„è¯·æ±‚ä¸€å®šè¦æ˜¯postã€putã€patchã€deleteä¹‹ä¸€ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘action*/}
      <Form method="post">
        <div>
          <label>First Name</label>
          <input type="text" name="customer" required />
        </div>

        <div>
          <label>Phone number</label>
          <div>
            <input type="tel" name="phone" required />
          </div>
        </div>

        <div>
          <label>Address</label>
          <div>
            <input type="text" name="address" required />
          </div>
        </div>

        <div>
          <input
            type="checkbox"
            name="priority"
            id="priority"
            // value={withPriority}
            // onChange={(e) => setWithPriority(e.target.checked)}
          />
          <label htmlFor="priority">Want to yo give your order priority?</label>
        </div>

        <div>
          <input type="hidden" name="cart" value={JSON.stringify(cart)} />
          <button>Order now</button>
        </div>
      </Form>
    </div>
  );
}


export async function action({ request }) {
  const formData = await request.formData();
  const data = Object.fromEntries(formData);

  const order = {
    ...data,
    cart: JSON.parse(data.cart),
    priority: data.priority === 'true',
  };

  console.log(order);

  const errors = {};
  if (!isValidPhone(order.phone))
    errors.phone =
      'Please give us your correct phone number. We might need it to contact you.';

  if (Object.keys(errors).length > 0) return errors;

  // If everything is okay, create new order and redirect
  const newOrder = await createOrder(order);


  return redirect(`/order/${newOrder.id}`);
}
export default CreateOrder;
```

**æ‹“å±•**

åˆ¤æ–­ç»„ä»¶æ˜¯å¦åœ¨æäº¤ï¼Œå¦‚æœåœ¨æäº¤ä¸­å°±ç¦ç”¨æäº¤æŒ‰é’®

```jsx
function CreateOrder(){
  const navigation = useNavigation();
  const isSubmitting = navigation.state === 'submitting';
    
  return (
    <div>
      <h2>Ready to order? Let's go!</h2>

      {/*æ³¨æ„Formçš„è¯·æ±‚ä¸€å®šè¦æ˜¯postã€putã€patchã€deleteä¹‹ä¸€ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘action*/}
      <Form method="post">
       	{/*çœç•¥*/}

        <div>
          <input type="hidden" name="cart" value={JSON.stringify(cart)} />
          <button disabled={isSubmitting}>Order now</button>
        </div>
      </Form>
    </div>
  );
}
```

#### actionçš„è¿”å›å€¼

å½“æˆ‘ä»¬æŠŠè·¯ç”±è§„åˆ™å’Œactionå‡½æ•°å»ºç«‹è¿æ¥åï¼Œè·¯ç”±ç»„ä»¶å°±å¯ä»¥é€šè¿‡useActionDataè·å¾—actionå‡½æ•°çš„è¿”å›å€¼ï¼Œä¾‹å¦‚

```jsx
const router = createBrowserRouter([
    {
        path:"menu",
        element:<Menu>,
        action:()=>{
                return 18
            }
    }
]) 
```

```jsx
import 
function Menu(){
    const data = useActionData()
    return <p>...</p>
}
```

**æ¡ˆä¾‹**

è¿™ä¸ªè¿”å›å€¼çš„ç”¨å¤„å¸¸å¸¸æ˜¯ç”¨æ¥æ•è·é”™è¯¯æˆ–è€…è·³è½¬ï¼Œ

```js
export async function action({ request }) {
  const formData = await request.formData();
  const data = Object.fromEntries(formData);
  console.log(formData);
  const order = {
    ...data,
    cart: JSON.parse(data.cart),
    priority: data.priority === 'true',
  };

  console.log(order);

  // è¡¨å•æ ¡éªŒåŠ é”™è¯¯å¤„ç†
  const errors = {};
  if (!isValidPhone(order.phone)){
       errors.phone =
      'Please give us your correct phone number. We might need it to contact you.';
  }
  if (Object.keys(errors).length > 0) return errors;

  const newOrder = await createOrder(order);
  return redirect(`/order/${newOrder.id}`);
}
```

æ•è·é”™è¯¯

```jsx
function CreateOrder(){
  const navigation = useNavigation();
  const isSubmitting = navigation.state === 'submitting';
  //å®é™…ä¸Šå°±æ˜¯æ¥æ”¶actionçš„è¿”å›å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œè¿™æ ·å‘½åæ˜¯å› ä¸ºæˆ‘ä»¬é’ˆå¯¹é”™è¯¯å¯¹è±¡
  let fromErrors = useActionData()
  return (
    <div>
      <h2>Ready to order? Let's go!</h2>

      {/*æ³¨æ„Formçš„è¯·æ±‚ä¸€å®šè¦æ˜¯postã€putã€patchã€deleteä¹‹ä¸€ï¼Œå¦åˆ™ä¸ä¼šè§¦å‘action*/}
      <Form method="post">
       	 <div>
          <label>Phone number</label>
          <div>
            <input type="tel" name="phone" required />
            {formErrors?.phone && (
              <p>
                {formErrors.phone}
              </p>
            )}
          </div>
        </div>

        <div>
          <input type="hidden" name="cart" value={JSON.stringify(cart)} />
          <button disabled={isSubmitting}>Order now</button>
        </div>
      </Form>
    </div>
  );
}
```

### é‡å®šå‘redirect

ç”±äºæˆ‘ä»¬çš„loaderå’Œactionæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨useNavigateï¼Œæ‰€ä»¥React routeræä¾›äº†ä¸ªæ–°å‡½æ•°æ¥è¿›è¡Œè·³è½¬ï¼Œä¸¾ä¾‹

```js
import { redirect } from "react-router-dom";

const loader = async () => {
  const user = await getUser();
  if (!user) {
    return redirect("/login");
  }
  return null;
};
```

å½“é‡å®šå‘æ˜¯ä¸ºäº†å“åº”æ•°æ®æ—¶ï¼Œå»ºè®®åœ¨åŠ è½½å™¨å’Œæ“ä½œä¸­ä½¿ç”¨ `redirect` ï¼Œè€Œä¸æ˜¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `useNavigate` ã€‚







